---
import { type CollectionEntry, getCollection } from "astro:content";
import MainLayout from "../../layouts/MainLayout.astro";
import client from "../../../tina/__generated__/client";
import AdminPropertyPost from "../../../tina/pages/AdminPropertyPost";
import ImageCarousel from "../../components/ImageCarousel.astro";
import { parseImageUrls, extractMapsSrc } from "../../utils/listings";

export async function getStaticPaths() {
  const properties = await getCollection("properties");

  return properties.map((property) => ({
    params: { slug: property.id },
    props: {
      property,
      getTinaProps: async () =>
        client.queries.properties({
          relativePath: property.data.tinaInfo.relativePath,
        }),
    },
  }));
}

const { property, getTinaProps } = Astro.props;
const tinaProps = await getTinaProps();
---

<MainLayout>
  <AdminPropertyPost {...tinaProps} client:tina />
</MainLayout>
